/**
 * ScOoly - Custom Scrollbar
 * Copyright (c) 2013 Sylvain "GouZ" Gougouzian (sylvain@gougouzian.fr)
 * MIT (http://www.opensource.org/licenses/mit-license.php) licensed.
 * GNU GPL (http://www.gnu.org/licenses/gpl.html) licensed.
 */
!function(e){var t=function(t,n){this.version=2.1;this.opts=n;this.$element=e(t);this.init()};t.prototype={init:function(){var t=this;this.$element.wrap("<div />").wrap("<div />");this.isMoving=false;this.visibleTrack={h:false,v:false};this.$wrapper=this.$element.parent().parent().css({position:"relative",overflow:"hidden"}).attr({"class":this.$element.attr("class"),id:this.$element.attr("id"),style:this.$element.attr("style")}).data("scrooly",this);this.$element.parent().css({width:"100%",position:"relative"});this.$element.attr("class","scr_content").removeAttr("id style");this.$element=e(".scr_content",this.$wrapper).css({position:"absolute",top:0,left:0,width:"100%",height:"auto"});e(">div",this.$wrapper).append('<div class="scr_track scr_trackV"><div class="scr_drag" /></div><div class="scr_track scr_trackH"><div class="scr_drag" /></div>');e(".scr_drag, .scr_track",this.$wrapper).css("position","absolute");e(".scr_drag",this.$wrapper).css({top:0,left:0});e(".scr_track",t.$wrapper).css("opacity",!this.opts.visible?0:this.opts.opacity);this.$trackV=e(".scr_trackV",this.$wrapper).css({top:0,right:0});this.dragV=e(".scr_drag",this.$trackV);this.$trackH=e(".scr_trackH",this.$wrapper).css({bottom:0,left:0});this.dragH=e(".scr_drag",this.$trackH);this.$wrapper.on({mouseenter:function(){t._toggleTracks(t.opts.opacity)},mouseleave:function(){t._toggleTracks(0)},mousewheel:function(e){var n=e.originalEvent?e.originalEvent:e;t._scroll(n.wheelDelta/120,n.wheelDeltaX,n.shiftKey);return false},DOMMouseScroll:function(e){var n=e.originalEvent?e.originalEvent:e;t._scroll(-n.detail/3,false,n.shiftKey);return false},touchstart:function(e){var n=e.originalEvent;t.previousMove=n.targetTouches[0];t.moveDrag=true;t._toggleTracks(t.opts.opacity)},touchmove:function(e){e.preventDefault();var n=e.originalEvent;t._$drag=t.$trackV;t._move(t.previousMove,n.targetTouches[0]);t._$drag=t.$trackH;t._move(t.previousMove,n.targetTouches[0]);t.previousMove={pageX:n.targetTouches[0].pageX,pageY:n.targetTouches[0].pageY}},touchend:function(){t.moveDrag=false;t._toggleTracks(0)}});e(".scr_drag",this.$wrapper).on({mousedown:function(n){n.preventDefault();t.moveDrag=true;t.previousMove=n;t._$drag=e(this).parent()},mouseenter:function(){e(this).addClass("scr_hover")},mouseleave:function(){e(this).removeClass("scr_hover")}});e(document).on({mouseup:function(){t.moveDrag=false;e(".scr_drag",t._$drag).removeClass("scr_moving")},mousemove:function(n){if(t.moveDrag){t._move(n,t.previousMove);t.previousMove=n;e(".scr_drag",t._$drag).addClass("scr_moving")}}});e(window).on("resize",function(){t.resize()}).trigger("resize")},_scroll:function(e,t,n){this._$drag=n||t?this.$trackH:this.$trackV;this._move((e<0?1:-1)*this.opts.step,0)},_toggleTracks:function(e){if(this.visibleTrack.h)this.$trackH.stop().animate({opacity:e},this.opts.speed);if(this.visibleTrack.v)this.$trackV.stop().animate({opacity:e},this.opts.speed)},resize:function(){this.height=this.$wrapper.height()-this.$trackH.outerHeight(true);this.width=this.$wrapper.width()-this.$trackV.outerWidth(true);this.$trackV.height(this.height);var e=this.$element.height(),t=this.$element.width(),n=Math.ceil(this.height*this.height/e),r=Math.ceil(this.width*this.width/t);if(n>this.height)n=this.height;if(r>this.width)r=this.width;this.visibleTrack={v:!(n==this.height),h:!(r==this.width)};this.ratio={v:this.height/e,h:this.width/t};this.dragV.height(n);this.dragH.width(r);this.maxT=this.height-n;this.maxL=this.width-r},_move:function(t,n){var r=e(".scr_drag",this._$drag).eq(0);if(this._$drag.hasClass("scr_trackV")){if(this.moveDrag){t=t.pageY;n=n.pageY}var i=parseInt(r.css("top"));i+=t-n;if(i>this.maxT)i=this.maxT;if(i<0)i=0;r.css("top",i);this.$element.css("top",Math.ceil(-i/this.ratio.v))}else{var i=parseInt(r.css("left"));if(this.moveDrag){t=t.pageX;n=n.pageX}i+=t-n;if(i>this.maxL)i=this.maxL;if(i<0)i=0;r.css("left",i);this.$element.css("left",Math.ceil(-i/this.ratio.h))}},moveTo:function(e,t){this._$drag=t=="x"?this.$trackH:this.$trackV;this._move(e,0)}};e.fn.scrooly=function(n,r,i){return this.each(function(){var s=e(this),o=s.data("scrooly"),u=e.extend({},e.fn.scrooly.defaults,s.data(),typeof n=="object"&&n);if(!o)s.data("scrooly",o=new t(this,u));if(typeof n=="string")o[n](r,i)})};e.fn.scrooly.defaults={step:15,opacity:.5,speed:200}}(window.jQuery);
